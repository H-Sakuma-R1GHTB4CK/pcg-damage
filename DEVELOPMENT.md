# 開発方針（pcg-damage）

## 目的
- ポケモンカードのダメージ計算を補助する個人用ツールのプロトタイプ。
- まずは弱点・抵抗・特性を無視した「足し算コンボ」を高速に作る UI を作る。
- 将来の拡張（弱点/抵抗/特性/軽減など）に耐えられるデータ構造を意識する。

## 現状の仕様
- クライアントのみの静的 HTML/JS。依存ライブラリなし。
- 攻撃側ページ（タブ）ごとに技・コンボ・仮想敵を管理。
- 技ボタンを押すと選択中コンボにセグメントを積み上げる。
- コンボ単位で積み上げ棒グラフを SVG で表示。仮想敵は水平点線。
- `localStorage` に JSON 保存・自動復元（キー: `pcg-damage-state-v1`）。

## 技術スタック/設計
- 言語: HTML + Vanilla JS + CSS。
- レンダリング: DOM 手書き（仮想DOMなし）。SVG で簡易チャート。
- 状態管理: 単一の `state` オブジェクトを commit() で保存＋再描画。
- レイアウト: CSS Grid。幅 900px 以上は 2 カラム、未満は縦積み。
- カラー: HSL を moveId から生成し、再現性のある配色に。

## データモデル（保存形）
- `AttackerPage { id, name, moves[], combos[], selectedComboId, enemies[] }`
- `MoveDef { id, name, dmg }`
- `Combo { id, name, segments[] }`
- `Segment { moveId, name, dmg }`
- `EnemyLine { id, name, hp }`
- 拡張余地: weakness/resistance/abilityReducer/exFlag などを各エンティティに追加予定。

## 保存ポリシー
- 主要操作ごとに commit() で `localStorage` に保存。
- 読み込み時に normalize して欠損/不正を補完し、データ破損で初期サンプルにフォールバック。
- バージョンキーを `v1` で管理。今後のマイグレーション時はキーを増やす。

## UI/UX ポイント
- コンボ削除で空になっても自動で空コンボを補充し、選択状態を維持。
- 技・コンボが空のときはプレースホルダ文言を表示。
- モバイルでは高さ/余白を縮め、カードを縦積み。
- チャートは棒上に合計値ラベル、仮想敵は黄色点線＋ラベル。

## 今後の優先TODO
1) インポート/エクスポート: JSON の保存・読み込みボタン（バックアップ用途）。
2) 編集 UI: 技・コンボ名のリネーム、並び替え。
3) グラフ改善: 水平方向スクロール（コンボ数増加時）、目盛りの最適化。
4) 検証/テスト: 簡易の単体テスト（例えば Vitest）か最小のスナップショットで状態遷移を確認。
5) 拡張設計: weakness/resistance/特性/軽減の計算順序をコメントとしてプロト設計に追記。
6) インジケータ: 2パン/3パンの参考ライン（将来検討）。

## 開発ルール
- 依存を極力増やさず、単一 HTML で完結する構成を維持する（必要になったらビルド導入を再検討）。
- 非破壊更新を優先し、既存データを壊さないマイグレーションを実装する。
- コメントは複雑な処理の直前に最小限で追加する（日本語可）。
- UI テキストは日本語で統一。

## テスト/確認の目安
- 新規ページ追加 → 技登録 → コンボ追加 → 技を積み上げ → 仮想敵追加 → 再読み込み後も状態が復元されること。
- モバイル幅（<900px）で縦積みレイアウトになること。
- コンボ全削除後、自動で空コンボが生成されること。
